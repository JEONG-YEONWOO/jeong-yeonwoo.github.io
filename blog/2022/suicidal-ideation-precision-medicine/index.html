<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Yeonwoo  JEONG | “먼저 손 내밀기”</title>
    <meta name="author" content="Yeonwoo  JEONG" />
    <meta name="description" content="CBCL-brain/PRS 상호작용을 고려한 자살사고 위험 예측과 맞춤형 개입을 통한 대한민국 아동청소년 자살사망률 감소 계획" />
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website" />


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous" />

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light" />

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://jeong-yeonwoo.github.io/blog/2022/suicidal-ideation-precision-medicine/">
    
    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark" />

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="https://jeong-yeonwoo.github.io/"><span class="font-weight-bold">Yeonwoo</span>   JEONG</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item active">
                <a class="nav-link" href="/blog/">blog</a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item dropdown ">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/publications/">publications</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="/projects/">projects</a>
                </div>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/teaching/">teaching</a>
              </li>

              <!-- Toogle theme mode -->
              <div class="toggle-container">
                <a id="light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </a>
              </div>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="container mt-5">
      <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">“먼저 손 내밀기”</h1>
    <p class="post-meta">December 14, 2022</p>
    <p class="post-tags">
      <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a>
        ·  
        <a href="/blog/tag/suicidal-ideation">
          <i class="fas fa-hashtag fa-sm"></i> suicidal-ideation</a>  
          <a href="/blog/tag/precision-medicine">
          <i class="fas fa-hashtag fa-sm"></i> precision-medicine</a>  
          
        ·  
        <a href="/blog/category/data-science-in-human-neuroimaging">
          <i class="fas fa-tag fa-sm"></i> data-science-in-human-neuroimaging</a>  
          

    </p>
  </header>

  <article class="post-content">
    <p>청소년 자살은 대한민국의 심각한 사회 문제가 된 지 오래다. 우리나라는 OECD 국가 간 연령표준화 자살률에서 불명예스러운 1위를 차지하기 일쑤이다. 청소년 사망원인 중 가장 많은 자살 비율은 갈수록 증가하고 있으며, 사망자 수가 줄어듦에도 자살사망률은 오히려 폭등하고 있다. 지난해 기준 하루 평균 자살 사망자 수는 36.6명으로, 39분마다 1명이 목숨을 끊는 셈이다. 아파트 대단지 한 곳에 대략 4000명이 산다고 하면, 단지마다 매년 1명이 자살하는 수준이라는 충격적인 결론에 도달한다. 최근에는 코로나19로 인한 사회적 고립이 청소년 자살사망률을 더 높이는 데에 일조하고 있기도 하다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_01-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_01-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_01-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_01.png" data-zoomable="">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_02-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_02-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_02-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_02.png" data-zoomable="">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_03-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_03-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_03-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_03.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
    청소년 자살은 대한민국의 심각한 사회 문제가 된 지 오래다.
</div>

<p>감소할 기미를 보이지 않는 청소년 자살사망률을 줄이기 위해 그간 여러 방면의 해결책이 제시되고 실행된 바 있다. 대표적으로 서울에서 ‘자살 명소’로 유명한 한강 다리에 힘이 되는 문구를 붙이거나, 전문 상담사와 통화할 수 있는 시설을 마련한 정책이 있다. 또 정신건강 전문가의 주도로 개발된 ‘보고 듣고 말하기’, ‘생명사랑지킴이 게이트키퍼 교육’ 같은 자살 예방 프로그램은 청소년 또래 집단을 대상으로 주변에 자살 위험이 있는 사람에게 적절한 도움을 줄 수 있도록 교육하고 있기도 하다. 그러나 이런 방안들이 각기 유효하더라도, 그 효과가 청소년 자살사망률의 가파른 증가세를 이겨내기는 쉽지 않아 보인다. 현재의 자살사망률 경향을 반전하고자 한다면, 예방 정책의 보호망을 빠져나가는 청소년의 특성을 고려하여 더 직접적이고 밀접한 개입 방안을 고안할 필요가 있다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_04-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_04-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_04-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_04.png" data-zoomable="">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_05-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_05-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_05-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_05.png" data-zoomable="">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_06-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_06-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_06-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_06.png" data-zoomable="">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_07-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_07-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_07-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_07.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
    아동청소년 자살사망률을 줄이기 위한 대표적인 기존 해결책.
</div>

<p>자살 예방 정책이 현재 자살을 생각하는 청소년의 목숨을 실제로 지켜주기 어려운 까닭 중 유독 눈에 띄는 것은 아픔을 대하는 우리나라의 사회 문화에 있다. 한국인은 자신의 치부를 드러내는 것을 터부시하고 완곡하게 말하는 습관이 있는데, 이는 많은 질환의 조기 개입에 방해 요소가 되기도 한다. 특히 비가시적인 고통이 수반되는 불안 및 우울 문제가 각박한 사회 환경 속에 증가하고 있음에도, 우리 사회는 안타깝게도 이를 나약함이나 의지 부족으로 낙인화하고 금기시하는 경향이 있다. 이런 정신건강 문제를 겪는 사람이 조금이라도 병식을 가지고 전문가를 찾아가기까지 시간이 오래 소요되어, 조기 개입이 어렵다는 것이다.</p>

<p>임상적으로 유의미한 예방 정책이 시행되고 있음에도 청소년 자살사망률이 증가하는 현상은, 어쩌면 자살사고를 숨겨 적당한 시기에 개입을 받지 못하는 청소년이 예상보다 많음을 방증하는 것일지도 모른다. 우리나라 사회 속에서 또래 집단 전체를 대상으로 한 예방 교육은 위험군 청소년이 오히려 자살사고를 부끄러운 것으로 생각하고, 또래처럼 ‘평범’하게 보이고자 자신을 더욱 압박하도록 만들었을 수 있다. 또 예방 교육이 효과가 있다고 하더라도, 청소년이 많은 시간을 보내는 가정에서 자살사고를 금기시하여 자신의 문제를 솔직히 털어놓기 꺼려졌을 수 있다. 실제로 사망 이전 경고신호를 보내는 자살사망자가 많았음에도 불구하고, 그를 가장 가깝게 보아 왔던 유가족은 그 경고신호를 감지하지 못하는 경우가 상당히 많았다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_08-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_08-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_08-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_08.png" data-zoomable="">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_09-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_09-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_09-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_09.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
    자살사고를 '만들어진 평범함' 뒤로 숨겨 적당한 시기에 개입을 받지 못하는 청소년이 많을 수 있다.
</div>

<p>물론 아픔, 특히 정신건강 문제를 인지하고 도움을 받는 것에 대한 사회적 부담이 적어져 자살사고를 하는 청소년이 제때 도움을 받는 것이 가장 이상적인 해결책일 것이다. 그러나 사회 문화가 이처럼 바뀌기를 기다리기에는 눈앞의 자살사망률 증가세가 너무 심각하다고 생각된다. 앞서 언급한 사회 문화를 고려하면, 자살사고를 솔직히 털어놓기 꺼리는 청소년을 발견하여 조기에 맞춤형으로 개입하는 방안은 자살 예방 보호망의 범위를 넓힐 가능성이 있다고 판단된다. 그리고 이런 청소년이 사회 곳곳에 있을 여지가 많으므로, 발견 방식은 자살사고의 유무를 직접적으로 묻기보다는 여러 간접적인 위험 지표를 바탕으로 추정함이 바람직해 보인다. 따라서 대한민국 아동청소년 자살사망률 감소라는 목표는 자살 위험이 있는 아이들을 찾아내는 효과적인 선별 모형을 마련하는 것으로 갈음할 수 있을 것으로 보인다.</p>

<hr>

<p>아동청소년의 자살 위험도를 평가하기 위해서는, 자살사고를 하는 아이들은 그렇지 않은 아이들과 무엇이 다른지 알아볼 필요가 있다. 이 선별 모형에 활용된 자료로는 인구통계학적 정보, 다중유전자위험점수(polygenic risk scores, 이하 PRS), 뇌 형태 정보(morphometry), 기능공명영상(functional MRI, 이하 fMRI)와 백질의 확산 영상(diffusion image, 이하 dMRI), 그리고 아동행동평가척도(child behavior checklist, 이하 CBCL) 점수가 있다.</p>

<p>PRS는 아동청소년이 타고난 자살사고에 대한 유전적 취약성을 의미하는데, 이 취약성은 바로 자살사고로 이어지지는 않는다. 현재까지 연구된 바에 따르면 유전 형질은 다양한 환경 변수의 영향을 받으며 행동 양식으로 발현되는데, 이때 뇌가 그 과정을 매개한다고 알려져 있다. 뇌 영역별 두께나 곡률 같은 형태학적 정보와 축삭이 많은 백질 부위의 연결성을 보여주는 확산 영상 자료를 활용한 것은 그 매개 양상을 반영하기 위함이다. 아울러 fMRI 자료는 ‘go-no go’ 과제 수행 중 영역별 활성도를 나타내는 지표를 취하였는데, 이는 신호에 맞춰 단추를 누를지를 빠르게 판단해야 하는 상황에서 충동 조절의 실질적 수준을 나타낸다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_10-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_10-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_10-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_10.jpg" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
    유전 형질은 다양한 환경 변수의 영향을 받으며 행동 양식으로 발현되는데, 이때 뇌가 그 과정을 매개한다고 알려져 있다.
</div>

<p>유전적 취약성이 실질적인 자살사고와 행동으로 연결될 때 환경적 요소의 영향 역시 무시할 수 없다. 다만 수없이 다양하고 개별적인 환경을 대변할 적당한 지표가 충분히 마련되어 있지 않기에, 이 선별 모형에는 학력이나 결혼 상태, 가정 수입 등 인구통계학적 수준에서 기본적인 지표만 몇몇 포함하였다. 한편 CBCL은 환경 변수의 영향을 받은 아동의 행동을 가장 가까이에서 양육자가 평가한 자료로, 환경 요소까지 반영된 최종적인 행동 양상을 드러냄으로써 인구통계학적 자료의 한계를 어느 정도 보완할 수 있을 것이 기대되었다.</p>

<p>위와 같은 자료를 바탕으로 효과적인 자살 위험군 아동 선별 모형을 제작하기 위하여, 통계 프로그래밍 언어인 R에서 h2o라는 기능을 활용, 자동화된 기계 학습(automated machine learning, 이하 autoML)을 수행하였다. 각 지표에 대한 아동청소년의 데이터는 미국 9~11세 아동을 대상으로 한 ABCD(adolescent brain cognitive development) 연구의 자료를 활용하였으며, 앞서 활용 자료로서 언급하였던 독립 변수들로 종속 변수인 자살사고 여부를 예측하는 모형을 학습시켰다. ABCD 자료 중 자살사고가 있다고 응답한 아동(실험군)과 건강 문제가 전혀 없다고 판단되는 아동(대조군)만을 취하여, 총 1750명을 대상으로 분석하였다. 독립 변수 중 공란이 많거나 분산이 0인 변수는 효과적인 분류에 방해가 될 것으로 판단하여 사전 제거하였으며, 연속형 변수는 평균 0, 표준편차 1로 표준화(scaling)하였다. CBCL 변수는 향후 모형의 적용이 용이하도록, 전체 자료를 필요로 하는 t점수 대신 원점수만을 선별하여 활용하였다.</p>

<p>autoML 결과의 신뢰도를 높이는 좋은 방법으로 모형을 학습시키는 데 사용되는 자료와 그 성능을 평가할 때 사용되는 자료를 분리하는 것이 있다. 이를 위해 전처리 과정을 거친 1750명 중 30%인 525명은 성능 평가용으로, 나머지 1225명은 학습용으로 분류되었다. 아울러 학습 자료 내에서는 자살사고 예측 성능이 뛰어나지만, 그 자료 자체의 특성이 집중적으로 학습되어 다른 자료에서 자살사고 여부를 예측하기 어려워지는 과적합(overfitting) 현상을 방지할 필요가 있었다. 이를 위하여 학습용인 1225명의 자료는 5개의 묶음(fold)으로 나뉘어 autoML에 반영되었다. autoML 과정에서는 GLM, GBM, deep learning, DRF, ensemble 등 다양한 ML 알고리즘을 최적화하여 주어진 모형에서 자살사고를 가장 잘 예측하도록 학습이 이루어졌다.</p>

<p>예측 모형의 성능은 AUC(area under the curve)와 민감도, 특이도를 중심으로 비교하였다. 민감도는 실제로 자살사고를 하는 사람 중 자살사고가 있다고 잘 예측되는 비율, 특이도는 실제로 건강한 사람 중 자살사고가 없다고 잘 예측되는 비율을 의미한다. AUC는 실제로 건강한 사람인데 자살사고가 있다고 잘못 예측된 위양성률이 특정 값으로 도출되는 모형의 민감도를 나타낸 ROC(receiver operating characteristic) 곡선 아래의 넓이를 의미한다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_11-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_11-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_11-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_11.jpg" data-zoomable="">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_12-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_12-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_12-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_12.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
    (왼쪽) ABCD 연구 설명. (오른쪽) autoML 연구 방법 개요.
</div>

<p>모든 독립 변수를 포함한 초기 모형을 학습하기 전, 각 변수의 예측력을 일변수 일반선형모형(GLM)을 통해 평가하였다. 단순선형 회귀선의 예측력이 유의미(p &lt; .05)한 변수를 선별하여 autoML을 진행한 결과, 학습된 모형은 종속 변수를 준수하게 예측하였다(AUC = 0.950, 민감도 = 0.816, 특이도 = 0.990). 눈에 띄었던 점은 독립 변수 선별 과정에서 거의 모든 CBCL 점수 변수가 선별 기준을 통과하였으며, 실제 예측 모형에서의 설명력도 아주 우세하였다는 점이다. 아래 각 변수의 설명력을 나타내는 그림에서 상위 11개 변수가 모두 CBCL 점수인 것을 확인할 수 있다.</p>

<p>한편 뇌 관련 자료는 독립 변수 선별 과정에서부터 많은 변수가 유의미한 예측력을 보이지 못하였다. 전체 변수 중 유의미하게 분류된 변수는 morphometry, fMRI, dMRI가 각각 2.57%, 0.29%, 5.60%로, dMRI 변수 중 예측력이 준수한 변수가 두드러졌으나 모두 CBCL 변수보다 단독 예측력은 덜하였다. 해당 dMRI 변수는 불안, 우울 및 보상회로와 연관이 있다고 알려진 왼쪽 편도체(amygdala)와 왼쪽 기댐핵(nucleus accumbens), 왼쪽 외측 안와전두피질(lateral orbitofrontal cortex)의 연결성, 그리고 왼쪽 섬엽(insula)과 오른쪽 중간관자이랑(middle temporal gyrus)의 연결성을 지목하였다. 이외에도 fMRI 변수 중 왼쪽 기댐핵의 활성화가 자살사고에 대한 유의미한 단독 예측력을 보이기도 하였다. 이들은 설명력이 거의 없었던 PRS와의 상호작용을 반영하여 개선된 예측력을 보일 것으로 기대되었다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_13-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_13-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_13-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_13.png" data-zoomable="">

  </picture>

</figure>

    </div>
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_14-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_14-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_14-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_14.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
    (왼쪽) 모든 독립 변수를 포함한 초기 autoML 결과, 최적합 학습 상태에서의 각 변수의 설명력. (오른쪽) 일변수 GLM을 통해 예측력이 유의미(p &lt; .05)하다고 평가된 변수의 비율. GM, WM 연결성, Task fMRI는 각각 morphometry, dMRI, fMRI를 나타냄.
</div>

<p>초기 분석에서 관찰된 CBCL 점수의 높은 자살사고 예측력은 기본적인 인구통계학적 정보와 함께 CBCL 변수만을 단독으로 반영한 모형에서도 매우 고무적으로 재현되었다(AUC = 0.966, 민감도 = 0.801, 특이도 = 0.990). CBCL 점수 중에서도 특히 내현화, 외현화를 포괄하는 총괄 문제행동 지수(total problem)와 불안(anxiety) 및 우울(depression) 관련 지수가 높은 설명력을 보였다. 실제로 CBCL 척도에 반영되는 역기능적 행동이나 심리적 외상, 우울 및 불안, 충동성 등은 자살사고의 유의미한 연관 요인으로 보고되기도 하였다. 그렇다면 전국 아동청소년의 양육자에게 CBCL 검사를 부탁하여 자살사고 여부를 예측하면 효과적으로 맞춤형 개입을 진행할 수 있는 것일까?</p>

<hr>

<p>CBCL 변수를 중심으로 자살사고 여부를 예측하는 모형은 한 가지 치명적인 단점을 내포하고 있는데, 바로 민감도가 낮다는 것이다. 이 단순한 모형의 특이도는 1에 거의 가까운데, 다시 말하면 실제로 자살사고를 하지 않는 건강한 아동은 거의 모두 자살사고가 없는 안전한 집단으로 분류된다는 것이다. 하지만 이 모형의 민감도는 80% 수준으로, 자살사고가 있는 아동 중 20%는 마치 자살사고가 없는 것으로 착각되어 안전한 집단으로 분류되고 만다. 만약 이 모형을 자살사고 여부 예측과 맞춤형 개입에 활용한다면, 2020년 기준 자살을 생각하는 우리나라 청소년 약 2000명 중 400명을 발견하지 못함은 물론, ‘안전하다’라고 오판할 가능성도 크다는 것이다. 양육자가 아동의 행동을 평가한다는 CBCL의 특성상, 자살사고 판단에서 위음성이 나오는 이들은 표면적으로는 건강해 보이지만 내면에 숨겨진 스트레스가 존재할 것으로 생각되었다. 혹은 양육자가 아동의 이상행동을 정확히 평가하지 못했을 수도 있다. ML에 활용된 자료가 미국 아동의 것임을 고려하면, 아픔을 터부시하는 우리 사회에 이 모형을 적용하였을 때의 민감도는 더 감소할 것으로 예상되었다. 따라서 이런 심각한 허점을 보완하기 위하여 CBCL 자료와 다른 자료의 상호작용을 예측 모형에 적절히 반영할 방안을 모색하고자 하였다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_15-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_15-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_15-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_15.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
     인구통계학적 정보(demographics)와 CBCL 변수만을 독립 변수로 설정한 autoML 모형으로 성능 평가용 자료 525명을 예측한 결과. 가로축은 모형의 예측 결과를, 세로축은 실제 자살사고(suicidal ideation, 이하 SI) 여부를 나타낸다. 이 모형의 민감도는 80% 수준으로, 자살사고가 있는 아동 중 20%는 마치 자살사고가 없는 것으로 착각되어 안전한 집단으로 분류되고 만다.
</div>

<hr>

<p>자살사고를 행동으로 드러내지 않고 숨기고 있는 청소년을 잘 발견하려면, CBCL 점수 외의 어떤 자료를 어떻게 활용해야 할까? 내재된 자살사고 경향이 행동 척도로 잘 예측되지 않는 것은 곧, 자살사고를 숨기는 위험군이 겉으로는 건강한 청소년과 큰 차이가 없어 원활히 구분되지 않음을 의미한다. 따라서 자살사고를 숨기는 청소년의 더 세세한 분류에는 PRS와 뇌 관련 자료가 나타내는 내면의 경향을 행동 양식과 연관짓는 것이 도움이 될 수 있다. 즉 겉으로는 몇 가지 행동 특성이 비슷해 보이지만, 건강한 청소년은 A 상태에서 그런 행동을 하는 반면 자살사고를 숨기고 있는 청소년은 B 상태임에도 유사한 행동을 하는 식이다. 이런 복합적인 관계는 ML에서 변수들을 서로 곱하여 모형에 추가하는 형태로 구현할 수 있다.</p>

<p>한 가지 더 고려할 만한 요소는 자살 위험도를 평가하는 예측 모형을 구축하는 데 드는 비용이다. CBCL 검사는 양육자에게 부탁하기도 편리하고, 시간 소모적이지 않으며, 비용도 비교적 저렴하다. 반면 세세한 분류를 위해 포함할 수 있는 유전체나 뇌 영상 분석은 시간 및 비용 문제와 더불어 검사 절차가 설문지만큼 간단하지는 않다. 따라서 유전체나 뇌 영상 분석이 CBCL 점수와 함께 고려될 때 자살사고 예측률을 유의미하게 증가시킨다고 해도, 그런 방법은 더 세세하게 구분해야 하는 때에만 시행하는 것이 적절할 것이다. CBCL 변수 중심 모형의 민감도를 보완하기 위해 다른 변수의 도입을 고려한 것이므로, CBCL 변수 중심 모형이 안전하다고 판단했던 청소년을 구분하는 데에 PRS나 뇌 영상 자료가 사용됨이 적절하다고 판단하였다. 물론 이런 방식은 위험군 중에서 고위험군과 저위험군을 세세하게 분류하는 통상적인 위험도 평가 모형과 차이를 보인다. 하지만 자살사망률을 감소시키려면 자살 위험이 없다고 오판되어 보호망을 빠져나가는 인원을 최소화하는 방법이 가장 효과적이라고 생각되었고, 그러려면 기존에 ‘안전’하다고 판단된 인원을 더 지켜보는 형태가 적절해 보였다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_16-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_16-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_16-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_16.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
     인구통계학적 정보와 CBCL만으로 구성된 autoML 모형의 민감도 문제를 보완하기 위하여, 두 단계의 예측 모형을 순차적으로 적용하는 절차를 고안하였다.
</div>

<p>요컨대 CBCL의 민감도 문제를 보완하기 위하여 두 단계의 자살 위험도 예측 모형을 순차적으로 적용하는 절차를 고안하였다. 1단계에는 전체 아동청소년 집단을 대상으로 CBCL 점수와 인구통계학적 정보를 반영하여 자살사고 여부를 예측한다. 자살사고가 있다고 판단된 아동은 바로 맞춤형 개입에 들어갈 수 있지만, 자살사고가 없다고 판단된 아동은 2단계 선별 절차를 거친다. 2단계는 1단계에서 자살사고가 없다고 판단된 아동 중 내재적으로 자살사고가 실제로 있는 아동을 선별하고자 하는데, 여기에서 위험하다고 판단된 아동 역시 맞춤형 개입의 대상이 된다.</p>

<p>위와 같은 절차의 2단계 모형으로 적절한 형태를 모색하고자, CBCL 점수와 인구통계학적 정보, 뇌 영상 자료를 다양한 조합으로 곱하여 autoML을 수행하였다. ML 학습은 기존과 같이 1225명의 학습용 자료로 진행하였으며, 성능 시험은 기존의 525명의 평가용 자료와 함께 2단계 절차에 적용될 때 적합성을 측정할 수 있는 시험 자료에 대해서도 추가로 진행하였다. 추가된 시험 자료는 기존에 CBCL 점수와 인구통계학적 정보만으로 구성된 예측 모형이 ‘안전하다’고 평가한 408명을 추출한 것이며, 적절한 자료 처리 과정을 통해 총 400명(건강한 아동 374명, 자살사고를 한 아동 26명)의 추가 시험 자료를 최종적으로 취하였다.</p>

<p>2단계 선별 절차에 활용될 수 있는 후보 autoML 모형들의 성능 평가 결과는 아래와 같다. CBCL 점수와 PRS, 뇌 영상 자료를 곱하여 독립 변수 목록에 추가하였을 때, 전체 자료를 대상으로 평가한 모형의 성능은 큰 변화가 없거나 오히려 인구통계학적 자료와 CBCL 점수만 포함한 모형보다 다소 저조했다. 그러나 1단계에서 안전하게 평가되었던 인원으로 구성된 추가 시험 자료를 대상으로 해당 모델들은 더 세부적인 구분이 용이한 것으로 드러났다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_17-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_17-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_17-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_17.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
     2단계 선별 절차에 활용될 수 있는 후보 autoML 모형들의 성능 평가 결과. Demographics는 인구통계학적 자료를 의미하며, dMRI라고 명시된 것은 dMRI 자료만, Brain이라고 명시된 것은 morphometry 및 fMRI 자료도 포함한 것이다. 모든 변수들은 일차적으로 단변수 GLM 모형에서 유의미한 예측력(p &lt; .01)을 보인 것을 선별하여 분석하였다. 실질 민감도 및 실질 특이도는 추가 시험 자료를 대상으로 구분한 결과를 의미한다.
</div>

<p>추가 시험 자료를 잘 분류한 2단계 선별 모형을 관찰했을 때, 공통적으로 CBCL 점수와 뇌 영상 자료를 곱한 항들의 설명력이 두드러지는 경향이 보였다. 특히 뇌 영상 중에서도 dMRI 자료가 CBCL 점수와 곱했을 때, CBCL 점수의 단독 설명 효과와 경합하는 양상을 보였다. 이는 백질 연결성을 나타내는 지표가 행동 특성과 연합되었을 때 건강한 아동과 유사한 행동 양식을 보이는 자살사고 내재 아동을 어느 정도 구별할 수 있음을 시사한다.</p>

<p>한편 CBCL 점수와 PRS 자료를 곱한 항들의 설명력은 비교적 미미하게 드러났다. 그렇다면 PRS는 자살사고 예측에 있어 효용성이 낮은 것일까? PRS와 뇌 영상, CBCL 점수를 모두 곱하여 독립 변수에 포함하였을 때 모형의 특이도가 개선되는 경향으로 보아, PRS는 타 자료와의 상호작용으로 예측 모형에 의미를 부여한다고 할 수 있겠다. 유전과 환경의 상호작용을 뇌가 매개한다는 관점에서 PRS와 뇌 영상의 상호작용 항은 단독 변수보다 높은 설명량을 지닌 것으로 예상되었다. 이 효과를 더 직접적으로 관찰하고자 인구통계학적 자료와 PRS, 뇌 영상을 각각 포함한 모형과, 그곳에 PRS와 뇌 영상 자료를 곱해 추가한 모형으로 전체 데이터에 대하여 autoML을 실시하였다. 그 결과 PRS와 뇌 영상 자료의 곱을 독립 변수로 포함하면 AUC나 전체 판단 대비 정확한 판단을 의미하는 정확도 지표가 괄목할 만한 개선을 보임을 알 수 있었다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_18-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_18-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_18-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_18.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
     뇌 영상 자료와 PRS는 단독으로는 설명력이 작지만, 상호작용을 나타내는 곱을 포함시켰을 때 모델의 설명력이 증가한다.
</div>

<p>2단계 선별 모형들의 성능을 비교하면, dMRI 영상이 포함되면서 내재된 자살사고가 있는 아동을 최대 약 50% 정도 추가로 발견할 수 있지만, 이와 함께 예측 특이도가 낮아진 것을 알 수 있다. 다만 이런 낮은 특이도는 PRS나 뇌 형태 계측, fMRI 자료와의 상호작용 항을 포함할 때 일부분 개선되는 것을 함께 확인할 수 있다. 결국 단독 설명량이 적은 PRS와 뇌 영상 데이터는 전체 설명량에는 미미한 영향밖에 미치지 못하지만, 실제 2단계 선별 과정에서 정확성을 높이는 세부 요인으로 작용할 수 있을 것이 기대되었다. 최종적으로 2단계 선별 모형으로 적합한 모형들은 아래와 같이 결정되었다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_19-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_19-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_19-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_19.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
     2단계 선별 절차에 적합한 autoML 모형. Demographics는 인구통계학적 자료를 의미하며, dMRI라고 명시된 것은 dMRI 자료만, Brain이라고 명시된 것은 morphometry 및 fMRI 자료도 포함한 것이다. 모든 변수들은 일차적으로 단변수 GLM 모형에서 유의미한 예측력(p &lt; .01)을 보인 것을 선별하여 분석하였다. 아래 표는 추가 시험 자료 400명을 예측한 결과. 가로축은 모형의 예측 결과를, 세로축은 실제 자살사고(suicidal ideation, 이하 SI) 여부를 나타낸다.
</div>

<p>요컨대 대한민국 아동청소년 자살사망률 감소를 위한 첫 걸음으로, 자살 위험군 아이들을 정확히 발견하는 예측 모형은 두 단계로 구성될 수 있다. 첫 단계는 전체 아동청소년 집단을 대상으로 양육자나 경우에 따라서는 임시 보호자, 교사 등이 CBCL 척도를 기록하고, 이를 인구통계학적 정보와 함께 수집하여 자살 위험도를 평가하는 것이다. 이때 안전하다고 평가된 아동들만을 대상으로 PRS 혹은 뇌 영상 자료를 위의 세부 구분 모형 각각에 알맞게 수집하여 자살사고를 내재한 ‘숨겨진 위험군’ 아동을 추가로 발견할 것이다. 이를 위한 국가적인 기구를 설립하고 절차를 진행하는 데 드는 대략의 예산은 다음과 같을 것으로 예상된다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_20-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_20-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_20-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_20.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
     자살 위험군 선별을 위한 예산안.
</div>

<p>자살 위험도 예측을 통해 위험군 아동을 분류한 후에는, 비로소 간접적으로 ‘스며드는’ 맞춤형 개입이 가능해진다. 기존에 자살사고를 하는 아동청소년이 전문가를 찾아가 속을 털어놓기까지 많은 시간과 용기가 필요했던 반면, 이제는 전수 조사로 위험한 아이들을 발견하여 전문가가 ‘먼저 손을 내밀’ 수 있는 것이다. 해당 청소년에게 친근한 환경에서 방문 상담을 진행함은 물론, 적절한 약물치료도 병행할 수 있고, 주변 사람들과의 유대를 형성하고 문제해결 훈련을 진행하는 다중체계 접근을 택할 수도 있을 것이다. 자살사고를 하지 않도록 ‘치료’한다는 단순한 접근은 특히 질환에 대한 우리 사회의 태도를 고려할 때 청소년으로 하여금 자살사고를 낙인이나 잘못으로 치부할 여지를 줄 수 있다. 정밀한 예측 모형을 바탕으로 한 맞춤형 개입은 이러한 여지를 최소화한 채로, 자살사고의 근본 원인일 수 있는 불안이나 우울에 대하여 이야기를 나누고, 총체적으로 ‘더 나은 삶을 살아가도록 돕는’ 방향에서 접근할 수 있다는 데에 의의가 있다.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    <source media="(max-width: 480px)" srcset="/assets/img/20221214_21-480.webp"></source>
    <source media="(max-width: 800px)" srcset="/assets/img/20221214_21-800.webp"></source>
    <source media="(max-width: 1400px)" srcset="/assets/img/20221214_21-1400.webp"></source>
    <!-- Fallback to the original file -->
    <img class="img-fluid rounded z-depth-1" src="/assets/img/20221214_21.png" data-zoomable="">

  </picture>

</figure>

    </div>
</div>
<div class="caption">
     자살 위험군 선별과 맞춤형 개입 비용을 모두 포함한 총 예산안.
</div>

<p>아울러 이처럼 ‘먼저 손을 내미는’ 데에 활용되었던 아동청소년의 자살 위험도 평가 자료는 자살사고 여부 예측 외에도 다양한 활용처가 있다. 우선 장기적으로 자살사고의 기여 요인과 병태 생리 연구를 위한 ‘한국형 ABCD’ 자료를 구축하여, 인종 간 차이를 극복한 한국인 대상 자살사고 연구의 초석을 마련할 수 있을 것이다. 아울러 해당 평가 자료는 자살사고뿐 아니라 불안 및 우울장애, 주의력 결핍 문제, 공격행동 등 다양한 역기능적 요소와 관련지어 아동청소년 정신병리 연구에 폭넓게 활용될 수 있다는 점에서 매력적이다. 이러한 향후 활용 계획까지 고려하면 약 2400~3000억 원을 들여 대한민국 아동청소년 자살사망률을 효과적으로 낮출 수 있을 것으로 기대된다.</p>

<p>[별첨] 분석에 사용된 코드</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182
1183
1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241
1242
1243
1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297
1298
1299
1300
1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
</pre></td>
<td class="code"><pre><span class="cp">#install.packages('plyr')
#install.packages('dplyr')
#install.packages('visdat')
#install.packages('ggplot2')
#install.packages('caret')
#install.packages('tibble')
#install.packages('tidyselect')
#install.packages('fastDummies')
</span>
<span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">visdat</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">tibble</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">tidyselect</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">fastDummies</span><span class="p">)</span>

<span class="cp"># read the data
</span><span class="n">abcd_SI</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">abcd_suicidal_ideation_hc0_SI1</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>
<span class="n">abcd_PRS</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">abcd_polygenic_scores</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>
<span class="n">abcd_cbcl</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">abcd_cbcl01</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>
<span class="n">abcd_brain_gm</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">abcd_brain_gm_freesurfer</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>
<span class="n">abcd_brain_wm</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">abcd_brain_wm_connectivity_fa</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>
<span class="n">abcd_brain_task</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">abcd_brain_task</span><span class="o">-</span><span class="n">fMRI_StopSignalTest</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>
<span class="n">abcd_demo</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">abcd_demographics</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">abcd_brain_wm</span> <span class="o">&lt;-</span> <span class="n">abcd_brain_wm</span> <span class="o">%&gt;%</span>
  <span class="n">mutate</span><span class="p">(</span><span class="n">subjectkey</span> <span class="o">=</span> <span class="n">paste</span><span class="p">(</span><span class="err">'</span><span class="n">NDAR</span><span class="sc">','</span><span class="n">_</span><span class="err">'</span><span class="p">,</span> <span class="n">substr</span><span class="p">(</span><span class="n">subjectkey</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="err">''</span><span class="p">))</span>
<span class="n">abcd_SI</span> <span class="o">&lt;-</span> <span class="n">abcd_SI</span> <span class="o">%&gt;%</span>
  <span class="n">mutate</span><span class="p">(</span><span class="n">subjectkey</span> <span class="o">=</span> <span class="n">paste</span><span class="p">(</span><span class="err">'</span><span class="n">NDAR</span><span class="sc">','</span><span class="n">_</span><span class="err">'</span><span class="p">,</span> <span class="n">substr</span><span class="p">(</span><span class="n">subjectkey</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="err">''</span><span class="p">))</span>
<span class="n">abcd_demo</span> <span class="o">&lt;-</span> <span class="n">abcd_demo</span> <span class="o">%&gt;%</span>
  <span class="n">mutate</span><span class="p">(</span><span class="n">subjectkey</span> <span class="o">=</span> <span class="n">paste</span><span class="p">(</span><span class="err">'</span><span class="n">NDAR</span><span class="sc">','</span><span class="n">_</span><span class="err">'</span><span class="p">,</span> <span class="n">substr</span><span class="p">(</span><span class="n">subjectkey</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="err">''</span><span class="p">))</span>

<span class="n">data_list</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="p">(</span><span class="n">abcd_demo</span><span class="p">,</span> <span class="n">abcd_SI</span><span class="p">,</span> <span class="n">abcd_PRS</span><span class="p">,</span> <span class="n">abcd_cbcl</span><span class="p">,</span> <span class="n">abcd_brain_gm</span><span class="p">,</span> <span class="n">abcd_brain_wm</span><span class="p">,</span> <span class="n">abcd_brain_task</span><span class="p">)</span>

<span class="cp"># inner join
</span><span class="n">data_inner_join</span> <span class="o">&lt;-</span> <span class="n">join_all</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="err">'</span><span class="n">subjectkey</span><span class="err">'</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="err">'</span><span class="n">inner</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># omit subjects out of research scope
</span><span class="n">data_inner_join</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_inner_join</span><span class="p">,</span> <span class="n">HCvsSI</span><span class="o">==</span><span class="mi">0</span> <span class="o">|</span> <span class="n">HCvsSI</span> <span class="o">==</span><span class="mi">1</span><span class="p">)</span>

<span class="cp"># correctly assign factor variables (high.educ, income considered continuous)
</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">sex</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">sex</span><span class="p">)</span>
<span class="n">data_inner_join</span><span class="err">$</span><span class="n">race</span><span class="p">.</span><span class="n">ethnicity</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">race</span><span class="p">.</span><span class="n">ethnicity</span><span class="p">)</span>
<span class="n">data_inner_join</span><span class="err">$</span><span class="n">married</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">married</span><span class="p">)</span>
<span class="n">data_inner_join</span><span class="err">$</span><span class="n">abcd_site</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">abcd_site</span><span class="p">)</span>
<span class="n">data_inner_join</span><span class="err">$</span><span class="n">HCvsSA</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">HCvsSA</span><span class="p">)</span>
<span class="n">data_inner_join</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span>

<span class="n">names</span><span class="p">(</span><span class="n">abcd_cbcl</span><span class="p">)[</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_cbcl</span><span class="p">)]</span> <span class="err">#</span> <span class="n">get</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">last</span> <span class="n">column</span>
<span class="n">data_inner_join</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_inner_join</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">cbcl_scr_07_stress_nm_2</span><span class="p">)</span> <span class="err">#</span> <span class="n">remove</span> <span class="n">the</span> <span class="n">empty</span> <span class="n">column</span> <span class="n">from</span> <span class="n">merge</span> <span class="n">data</span>

<span class="cp"># check for NAs in factor variables
</span><span class="n">sum</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">sex</span><span class="p">))</span>
<span class="n">sum</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">race</span><span class="p">.</span><span class="n">ethnicity</span><span class="p">))</span>
<span class="n">sum</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">married</span><span class="p">))</span>
<span class="n">sum</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">abcd_site</span><span class="p">))</span>
<span class="n">sum</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">HCvsSA</span><span class="p">))</span>
<span class="n">sum</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">data_inner_join</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">))</span>

<span class="cp"># omit NAs in factor variables
</span><span class="n">data_inner_join_2</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_inner_join</span><span class="p">,</span>
                            <span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">sex</span><span class="p">)</span><span class="o">==</span><span class="n">FALSE</span>
                            <span class="o">&amp;</span> <span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">race</span><span class="p">.</span><span class="n">ethnicity</span><span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span>
                            <span class="o">&amp;</span> <span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">married</span><span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span>
                            <span class="o">&amp;</span> <span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">abcd_site</span><span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span>
                            <span class="o">&amp;</span> <span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">HCvsSA</span><span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span>
                            <span class="o">&amp;</span> <span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="o">==</span> <span class="n">FALSE</span><span class="p">)</span>

<span class="cp"># median NA imputation for numeric variables
</span><span class="n">data_inner_join_imp</span> <span class="o">&lt;-</span> <span class="n">data_inner_join_2</span> <span class="o">%&gt;%</span>
  <span class="n">mutate_if</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">numeric</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">ifelse</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">na</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">na</span><span class="p">.</span><span class="n">rm</span> <span class="o">=</span> <span class="n">T</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span>

<span class="cp"># filter zero and near-zero variances
</span><span class="n">data_inner_join_imp_filt</span> <span class="o">&lt;-</span> <span class="n">data_inner_join_imp</span><span class="p">[,</span><span class="o">-</span><span class="n">nearZeroVar</span><span class="p">(</span><span class="n">data_inner_join_imp</span><span class="p">)]</span>

<span class="cp"># scaling
</span><span class="n">names</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">)[</span><span class="mi">12</span><span class="o">:</span><span class="mi">18</span><span class="p">]</span> <span class="err">#</span> <span class="n">number</span> <span class="n">of</span> <span class="n">columns</span> <span class="n">with</span> <span class="n">PRS</span> <span class="nf">variables</span> <span class="p">(</span><span class="n">don</span><span class="err">'</span><span class="n">t</span> <span class="n">need</span> <span class="n">scaling</span><span class="p">)</span>

<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="mi">11</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">[,</span><span class="n">i</span><span class="p">])){</span>
    <span class="n">data_inner_join_imp_filt</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">scale</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">[,</span><span class="n">i</span><span class="p">])</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">19</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">)){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">[,</span><span class="n">i</span><span class="p">])){</span>
    <span class="n">data_inner_join_imp_filt</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">scale</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">[,</span><span class="n">i</span><span class="p">])</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data_inner_join_imp_filt</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">200</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="p">]</span>

<span class="cp"># convert 'sex' variable from (1,2) encoding to (0,1)
</span><span class="n">data_inner_join_imp_filt</span><span class="err">$</span><span class="n">sex</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">numeric</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="err">$</span><span class="n">sex</span><span class="p">)</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">nrow</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">)){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">){</span>
    <span class="n">data_inner_join_imp_filt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="mi">0</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">){</span>
    <span class="n">data_inner_join_imp_filt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="mi">1</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">data_inner_join_imp_filt</span><span class="err">$</span><span class="n">sex</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="err">$</span><span class="n">sex</span><span class="p">)</span>

<span class="cp"># dummy code categorical variables (race.ethnicity, married, abcd_site, HCvsSA)
</span><span class="n">data_inner_join_imp_filt</span> <span class="o">&lt;-</span> <span class="n">dummy_cols</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">,</span> <span class="n">select_columns</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">race</span><span class="p">.</span><span class="n">ethnicity</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">married</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">abcd_site</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">HCvsSA</span><span class="err">'</span><span class="p">))</span>
<span class="n">data_inner_join_imp_filt</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4041</span><span class="o">:</span><span class="mi">4075</span><span class="p">)]</span> <span class="err">#</span><span class="n">check</span> <span class="n">that</span> <span class="n">dummy</span> <span class="n">coding</span> <span class="n">is</span> <span class="n">successful</span>

<span class="cp"># remove unneeded variables
</span><span class="n">data_inner_join_imp_filt_2</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">race</span><span class="p">.</span><span class="n">ethnicity</span><span class="p">)</span>
<span class="n">data_inner_join_imp_filt_2</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_inner_join_imp_filt_2</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">married</span><span class="p">)</span>
<span class="n">data_inner_join_imp_filt_2</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_inner_join_imp_filt_2</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">abcd_site</span><span class="p">)</span>
<span class="n">data_inner_join_imp_filt_2</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_inner_join_imp_filt_2</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">HCvsSA</span><span class="p">)</span>
<span class="n">data_inner_join_imp_filt_2</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_inner_join_imp_filt_2</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">sex</span><span class="mf">.1</span><span class="p">)</span>

<span class="cp"># save data
</span><span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">data_inner_join_imp_filt</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">data_inner_join_imp_filt</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">data_inner_join_imp_filt_2</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">data_inner_join_imp_filt_modified</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>
<span class="n">data_final</span> <span class="o">&lt;-</span> <span class="n">data_inner_join_imp_filt</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="err">'</span><span class="n">data_final</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">,</span> <span class="n">row</span><span class="p">.</span><span class="n">names</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="cp"># read the data
</span><span class="n">data_final</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">data_final</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># modify data_final
</span><span class="n">data_modified</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">c</span><span class="p">(</span><span class="n">race</span><span class="p">.</span><span class="n">ethnicity</span><span class="p">,</span>
                                              <span class="n">married</span><span class="p">,</span>
                                              <span class="n">abcd_site</span><span class="p">,</span>
                                              <span class="n">HCvsSA</span><span class="p">))</span> <span class="err">#</span><span class="n">dummy</span><span class="o">-</span><span class="n">coded</span>
<span class="n">data_modified</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_modified</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">c</span><span class="p">(</span><span class="n">ethnic_g</span><span class="p">,</span>
                                                 <span class="n">interview_age</span><span class="p">,</span>
                                                 <span class="n">sex</span><span class="mf">.1</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_anxdep_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_withdep_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_somatic_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_social_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_thought_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_attention_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_rulebreak_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_aggressive_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_internal_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_external_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_syn_totprob_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_dsm5_depress_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_dsm5_anxdisord_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_dsm5_somaticpr_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_dsm5_adhd_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_dsm5_opposit_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_dsm5_conduct_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_07_sct_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_07_ocd_t</span><span class="p">,</span>
                                                 <span class="n">cbcl_scr_07_stress_t</span><span class="p">,</span>
                                                 <span class="n">abcd_site_1</span><span class="p">,</span>
                                                 <span class="n">abcd_site_2</span><span class="p">,</span>
                                                 <span class="n">abcd_site_3</span><span class="p">,</span>
                                                 <span class="n">abcd_site_4</span><span class="p">,</span>
                                                 <span class="n">abcd_site_5</span><span class="p">,</span>
                                                 <span class="n">abcd_site_6</span><span class="p">,</span>
                                                 <span class="n">abcd_site_7</span><span class="p">,</span>
                                                 <span class="n">abcd_site_8</span><span class="p">,</span>
                                                 <span class="n">abcd_site_9</span><span class="p">,</span>
                                                 <span class="n">abcd_site_10</span><span class="p">,</span>
                                                 <span class="n">abcd_site_11</span><span class="p">,</span>
                                                 <span class="n">abcd_site_12</span><span class="p">,</span>
                                                 <span class="n">abcd_site_13</span><span class="p">,</span>
                                                 <span class="n">abcd_site_14</span><span class="p">,</span>
                                                 <span class="n">abcd_site_15</span><span class="p">,</span>
                                                 <span class="n">abcd_site_16</span><span class="p">,</span>
                                                 <span class="n">abcd_site_17</span><span class="p">,</span>
                                                 <span class="n">abcd_site_18</span><span class="p">,</span>
                                                 <span class="n">abcd_site_19</span><span class="p">,</span>
                                                 <span class="n">abcd_site_20</span><span class="p">,</span>
                                                 <span class="n">abcd_site_21</span><span class="p">))</span> <span class="err">#</span><span class="n">unrelevant</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">data_modified</span><span class="p">,</span> <span class="err">'</span><span class="n">data_final_modified</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">,</span> <span class="n">row</span><span class="p">.</span><span class="n">names</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="n">data_modified_2</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_modified</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">c</span><span class="p">(</span><span class="n">HCvsSA_0</span><span class="p">,</span>
                                                   <span class="n">HCvsSA_1</span><span class="p">,</span>
                                                   <span class="n">HCvsSA_2</span><span class="p">))</span> <span class="err">#</span><span class="n">w</span><span class="o">/</span><span class="n">o</span> <span class="n">suicidal</span> <span class="n">attempt</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">data_modified_2</span><span class="p">,</span> <span class="err">'</span><span class="n">data_final_modified_2</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">,</span> <span class="n">row</span><span class="p">.</span><span class="n">names</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="cp"># re-read modified data
</span><span class="n">data_final</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">data_final_modified</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># make this reproducible
</span><span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="cp">#split into train and test data
</span><span class="n">train</span><span class="p">.</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="n">createDataPartition</span><span class="p">(</span><span class="n">data_final</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span> <span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>
<span class="n">test</span>  <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>

<span class="n">table</span><span class="p">(</span><span class="n">data_final</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">full</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">train</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">test</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">test</span> <span class="n">set</span>

<span class="cp"># identify predictor and response
</span><span class="n">y</span> <span class="o">&lt;-</span> <span class="s">"HCvsSI"</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="n">setdiff</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="cp"># for binary classification, response should be a factor
</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>
<span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>

<span class="cp"># run glm: y ~ x
# family='binomial' for logistic regression
# example for age and sex
</span><span class="n">example_x</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">age</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">sex</span><span class="err">'</span><span class="p">)</span>
<span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="n">example_x</span><span class="p">){</span>
  <span class="n">form</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="sc">'~'</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
  <span class="n">fit</span> <span class="o">&lt;-</span> <span class="n">glm</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">formula</span><span class="p">(</span><span class="n">form</span><span class="p">),</span> <span class="n">family</span><span class="o">=</span><span class="err">'</span><span class="n">binomial</span><span class="err">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
  <span class="n">print</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">formula</span><span class="p">(</span><span class="n">form</span><span class="p">))</span>
  <span class="n">p_value</span> <span class="o">&lt;-</span> <span class="n">coef</span><span class="p">(</span><span class="n">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">))[,</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">print</span><span class="p">(</span><span class="n">p_value</span><span class="p">)</span>
  <span class="k">if</span><span class="p">(</span><span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">){</span>
    <span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">x_significant</span><span class="p">,</span> <span class="n">names</span><span class="p">(</span><span class="n">p_value</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="n">print</span><span class="p">(</span><span class="n">x_significant</span><span class="p">)</span>
<span class="p">}</span>

<span class="cp"># same loop for all predictors
</span><span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="n">x</span><span class="p">){</span>
  <span class="n">form</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="sc">'~'</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
  <span class="n">fit</span> <span class="o">&lt;-</span> <span class="n">glm</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">formula</span><span class="p">(</span><span class="n">form</span><span class="p">),</span> <span class="n">family</span><span class="o">=</span><span class="err">'</span><span class="n">binomial</span><span class="err">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
  <span class="n">p_value</span> <span class="o">&lt;-</span> <span class="n">coef</span><span class="p">(</span><span class="n">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">))[,</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
  <span class="k">if</span><span class="p">(</span><span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">){</span>
    <span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">x_significant</span><span class="p">,</span> <span class="n">names</span><span class="p">(</span><span class="n">p_value</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">head</span><span class="p">(</span><span class="n">x_significant</span><span class="p">)</span>

<span class="cp"># add age as the necessary covariate
</span><span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="err">'</span><span class="n">age</span><span class="err">'</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">)</span>

<span class="cp"># extract the significant features from the train and test sets
</span><span class="n">train</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">))</span>
<span class="n">test</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">))</span>

<span class="cp"># prepare for Auto ML
</span><span class="n">h2o</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="cp"># create an index column for stratified cross-validation
</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">rep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">fold_column</span><span class="p">,</span> <span class="n">train</span><span class="p">)</span>

<span class="n">k_folds</span> <span class="o">&lt;-</span> <span class="mi">5</span>
<span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train</span><span class="err">$</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">createFolds</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_folds</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span> <span class="err">#</span><span class="n">healthy</span> <span class="n">controls</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)])</span> <span class="err">#</span><span class="n">suicidal</span> <span class="n">ideation</span>

<span class="cp"># train the model
</span><span class="n">train_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">aml</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">automl</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_significant</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                  <span class="n">training_frame</span><span class="o">=</span><span class="n">train_h2o</span><span class="p">,</span>
                  <span class="n">max_models</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                  <span class="n">max_runtime_secs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                  <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">fold_column</span><span class="o">=</span><span class="err">'</span><span class="n">fold_column</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># view the AutoML Leaderboard
</span><span class="n">lb</span> <span class="o">&lt;-</span> <span class="n">aml</span><span class="err">@</span><span class="n">leaderboard</span>
<span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="err">#</span><span class="n">use</span> <span class="n">print</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">nrow</span><span class="p">(</span><span class="n">lb</span><span class="p">))</span> <span class="n">to</span> <span class="n">print</span> <span class="n">all</span> <span class="n">rows</span> <span class="n">instead</span> <span class="n">of</span> <span class="k">default</span> <span class="p">(</span><span class="mi">6</span> <span class="n">rows</span><span class="p">)</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">initial</span> <span class="n">automl</span> <span class="n">models_modified</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># the leader model is stored here: aml@leader
</span>
<span class="cp"># prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">prediction_H2OAutoML_modified</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">prediction_leadermodel_modified</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>

<span class="cp"># check the variable importance
</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">50</span><span class="p">,]</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">)),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">variable</span> <span class="n">importance_modified</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># read the data
</span><span class="n">data_final</span> <span class="o">&lt;-</span> <span class="n">read</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="err">'</span><span class="n">data_final_modified</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># make this reproducible
</span><span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="cp">#split into train and test data
</span><span class="n">train</span><span class="p">.</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="n">createDataPartition</span><span class="p">(</span><span class="n">data_final</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span> <span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>
<span class="n">test</span>  <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>

<span class="n">table</span><span class="p">(</span><span class="n">data_final</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">full</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">train</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">test</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">test</span> <span class="n">set</span>

<span class="cp"># -----
</span>
<span class="cp"># CASE F1: DEMO + CBCL
# identify predictor and response
</span><span class="n">y</span> <span class="o">&lt;-</span> <span class="s">"HCvsSI"</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="n">names</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="o">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">4014</span><span class="o">:</span><span class="mi">4024</span><span class="p">)])</span>

<span class="cp"># for binary classification, response should be a factor
</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>
<span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>

<span class="cp"># prepare for Auto ML
</span><span class="n">h2o</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="cp"># create an index column for stratified cross-validation
</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">rep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">fold_column</span><span class="p">,</span> <span class="n">train</span><span class="p">)</span>

<span class="n">k_folds</span> <span class="o">&lt;-</span> <span class="mi">5</span>
<span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train</span><span class="err">$</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">createFolds</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_folds</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span> <span class="err">#</span><span class="n">healthy</span> <span class="n">controls</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)])</span> <span class="err">#</span><span class="n">suicidal</span> <span class="n">ideation</span>

<span class="cp"># train the model
</span><span class="n">train_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">aml</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">automl</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                  <span class="n">training_frame</span><span class="o">=</span><span class="n">train_h2o</span><span class="p">,</span>
                  <span class="n">max_models</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                  <span class="n">max_runtime_secs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                  <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">fold_column</span><span class="o">=</span><span class="err">'</span><span class="n">fold_column</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># view the AutoML Leaderboard
</span><span class="n">lb</span> <span class="o">&lt;-</span> <span class="n">aml</span><span class="err">@</span><span class="n">leaderboard</span>
<span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="err">#</span><span class="n">use</span> <span class="n">print</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">nrow</span><span class="p">(</span><span class="n">lb</span><span class="p">))</span> <span class="n">to</span> <span class="n">print</span> <span class="n">all</span> <span class="n">rows</span> <span class="n">instead</span> <span class="n">of</span> <span class="k">default</span> <span class="p">(</span><span class="mi">6</span> <span class="n">rows</span><span class="p">)</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_initial</span> <span class="n">automl</span> <span class="n">models_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># the leader model is stored here: aml@leader
</span>
<span class="cp"># prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_H2OAutoML_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_leadermodel_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>

<span class="cp"># check the variable importance
</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">50</span><span class="p">,]</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">)),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_variable</span> <span class="n">importance_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># explain leader model &amp; compare with all AutoML models
</span><span class="n">exp</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">explain</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">exp</span>

<span class="cp"># append variables predicted 0 (w/o SI) to new test list
</span><span class="n">test_new</span> <span class="o">&lt;-</span> <span class="n">test</span>
<span class="n">test_new</span><span class="err">$</span><span class="n">predict</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">vector</span><span class="p">(</span><span class="n">pred</span><span class="err">$</span><span class="n">predict</span><span class="p">)</span>
<span class="n">test_new</span><span class="err">$</span><span class="n">predict</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">test_new</span><span class="err">$</span><span class="n">predict</span><span class="p">)</span>
<span class="n">test_new</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">test_new</span><span class="p">,</span> <span class="n">predict</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_new</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">test_new</span><span class="p">,</span> <span class="n">select</span><span class="o">=-</span><span class="n">predict</span><span class="p">)</span>
<span class="n">summary</span><span class="p">(</span><span class="n">test_new</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span>
<span class="n">summary</span><span class="p">(</span><span class="n">test</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">test_new</span><span class="p">,</span> <span class="err">'</span><span class="n">FINAL_test_new</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">,</span> <span class="n">row</span><span class="p">.</span><span class="n">names</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="cp"># -----
</span>
<span class="cp"># CASE F2 : demo + cbcl + cbcl*dmri
</span>
<span class="cp"># extract brain and cbcl features from data
# only important brain features will be used
</span>
<span class="n">brain_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"con_L.TTG_R.PCU_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.LOFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.MOFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CU_R.SPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.IN_R.MTG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PaCG_L.CA_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.HI_R.MTG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.EC_L.IPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PCG_R.SMG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.FG_R.SMG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PaCG_R.CMFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.IN_L.CA_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PCAL_R.TH_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PHIG_L.SPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.PHIG_R.PoCG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.POR_L.PU_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.POP_L.RMFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.PaCG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.CA_R.PTR_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.LG_R.ITG_fa"</span><span class="p">)</span>
<span class="n">brain_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">brain_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">brain_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">brain_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">abcd_brain_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">brain_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_brain_final &lt;- subset(test_new, select=brain_names_sel)
</span>
<span class="n">cbcl_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"cbcl_scr_syn_anxdep_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_withdep_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_somatic_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_social_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_thought_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_attention_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_rulebreak_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_aggressive_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_internal_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_external_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_totprob_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_depress_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_anxdisord_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_somaticpr_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_adhd_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_opposit_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_conduct_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_sct_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_ocd_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_stress_r"</span><span class="p">)</span>
<span class="n">cbcl_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">cbcl_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">cbcl_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">cbcl_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">abcd_cbcl_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">cbcl_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_cbcl_final &lt;- subset(test_new, select=cbcl_names_sel)
</span>
<span class="cp"># cross brain and cbcl features
# save the crossed features into crossed_data
</span>
<span class="n">crossed_data</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)){</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)){</span>
    <span class="n">crossed_feature</span> <span class="o">&lt;-</span> <span class="n">abcd_brain_final</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_cbcl_final</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span>
    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">,</span> <span class="n">crossed_feature</span><span class="p">)</span>

    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)[</span><span class="n">j</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="sc">'_'</span><span class="p">)</span>
    <span class="n">colnames</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)[</span><span class="n">which</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span> <span class="o">==</span> <span class="err">'</span><span class="n">crossed_feature</span><span class="err">'</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="n">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data_final_crossed</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">crossed_data</span><span class="p">)</span>
<span class="cp">#test_new_keep &lt;- test_new
#test_new &lt;- data.frame(test_new, crossed_data)
</span>
<span class="n">ncol</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="p">)</span>

<span class="cp"># make this reproducible
</span><span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="cp">#split into train and test data
</span><span class="n">train</span><span class="p">.</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="n">createDataPartition</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data_final_crossed</span><span class="p">[</span> <span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>
<span class="n">test</span>  <span class="o">&lt;-</span> <span class="n">data_final_crossed</span><span class="p">[</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>

<span class="n">table</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">full</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">train</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">test</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">test</span> <span class="n">set</span>

<span class="cp"># identify predictor and response
</span><span class="n">y</span> <span class="o">&lt;-</span> <span class="s">"HCvsSI"</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="n">names</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="o">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">4014</span><span class="o">:</span><span class="mi">4024</span><span class="p">,</span><span class="mi">4028</span><span class="o">:</span><span class="mi">4427</span><span class="p">)])</span>

<span class="cp"># for binary classification, response should be a factor
</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>
<span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>

<span class="cp"># prepare for Auto ML
</span><span class="n">h2o</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="cp"># create an index column for stratified cross-validation
</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">rep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">fold_column</span><span class="p">,</span> <span class="n">train</span><span class="p">)</span>

<span class="n">k_folds</span> <span class="o">&lt;-</span> <span class="mi">5</span>
<span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train</span><span class="err">$</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">createFolds</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_folds</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span> <span class="err">#</span><span class="n">healthy</span> <span class="n">controls</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)])</span> <span class="err">#</span><span class="n">suicidal</span> <span class="n">ideation</span>

<span class="cp"># train the model
</span><span class="n">train_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">aml</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">automl</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                  <span class="n">training_frame</span><span class="o">=</span><span class="n">train_h2o</span><span class="p">,</span>
                  <span class="n">max_models</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                  <span class="n">max_runtime_secs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                  <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">fold_column</span><span class="o">=</span><span class="err">'</span><span class="n">fold_column</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># view the AutoML Leaderboard
</span><span class="n">lb</span> <span class="o">&lt;-</span> <span class="n">aml</span><span class="err">@</span><span class="n">leaderboard</span>
<span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="err">#</span><span class="n">use</span> <span class="n">print</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">nrow</span><span class="p">(</span><span class="n">lb</span><span class="p">))</span> <span class="n">to</span> <span class="n">print</span> <span class="n">all</span> <span class="n">rows</span> <span class="n">instead</span> <span class="n">of</span> <span class="k">default</span> <span class="p">(</span><span class="mi">6</span> <span class="n">rows</span><span class="p">)</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_initial</span> <span class="n">automl</span> <span class="n">models_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="o">+</span><span class="n">cbcldmri</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># the leader model is stored here: aml@leader
</span>
<span class="cp"># prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_H2OAutoML_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="o">+</span><span class="n">cbcldmri</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_leadermodel_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="o">+</span><span class="n">cbcldmri</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>

<span class="cp"># check the variable importance
</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">50</span><span class="p">,]</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">)),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_variable</span> <span class="n">importance_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="o">+</span><span class="n">cbcldmri</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># explain leader model &amp; compare with all AutoML models
</span><span class="n">exp</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">explain</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">exp</span>

<span class="cp"># test on test_new
# prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test_new</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_H2OAutoML_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="o">+</span><span class="n">cbcldmri_vul</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_leadermodel_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="o">+</span><span class="n">cbcldmri_vul</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>

<span class="cp"># -----
</span>
<span class="cp"># CASE F3 : demo + cbcl + cbcl*prs + cbcl*dmri + cbcl*prs*dmri
</span>
<span class="cp"># extract brain and cbcl features from data
# only important brain features will be used
</span>
<span class="n">PRS_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"ADHDeur6"</span><span class="p">,</span> <span class="s">"SCZ_EURauto"</span><span class="p">,</span> <span class="s">"GHappiMeaneur1"</span><span class="p">,</span> <span class="s">"ASDauto"</span><span class="p">,</span> <span class="s">"MDDeur6"</span><span class="p">,</span> <span class="s">"PTSDeur4"</span><span class="p">)</span>
<span class="n">PRS_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">PRS_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">PRS_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">PRS_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">abcd_PRS_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">PRS_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_PRS_final &lt;- subset(test_new, select=PRS_names_sel)
</span>
<span class="n">brain_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"con_L.TTG_R.PCU_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.LOFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.MOFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CU_R.SPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.IN_R.MTG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PaCG_L.CA_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.HI_R.MTG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.EC_L.IPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PCG_R.SMG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.FG_R.SMG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PaCG_R.CMFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.IN_L.CA_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PCAL_R.TH_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PHIG_L.SPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.PHIG_R.PoCG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.POR_L.PU_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.POP_L.RMFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.PaCG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.CA_R.PTR_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.LG_R.ITG_fa"</span><span class="p">)</span>
<span class="n">brain_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">brain_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">brain_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">brain_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">abcd_brain_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">brain_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_brain_final &lt;- subset(test_new, select=brain_names_sel)
</span>
<span class="n">cbcl_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"cbcl_scr_syn_anxdep_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_withdep_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_somatic_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_social_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_thought_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_attention_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_rulebreak_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_aggressive_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_internal_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_external_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_totprob_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_depress_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_anxdisord_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_somaticpr_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_adhd_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_opposit_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_conduct_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_sct_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_ocd_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_stress_r"</span><span class="p">)</span>
<span class="n">cbcl_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">cbcl_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">cbcl_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">cbcl_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">abcd_cbcl_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">cbcl_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_cbcl_final &lt;- subset(test_new, select=cbcl_names_sel)
</span>
<span class="cp"># cross PRS and cbcl features
# save the crossed features into crossed_data
</span>
<span class="n">crossed_data</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_PRS_final</span><span class="p">)){</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)){</span>
    <span class="n">crossed_feature</span> <span class="o">&lt;-</span> <span class="n">abcd_PRS_final</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_cbcl_final</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span>
    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">,</span> <span class="n">crossed_feature</span><span class="p">)</span>

    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">abcd_PRS_final</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)[</span><span class="n">j</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="sc">'_'</span><span class="p">)</span>
    <span class="n">colnames</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)[</span><span class="n">which</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span> <span class="o">==</span> <span class="err">'</span><span class="n">crossed_feature</span><span class="err">'</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="n">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data_final_crossed</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">crossed_data</span><span class="p">)</span>
<span class="cp">#test_new_keep &lt;- test_new
#test_new &lt;- data.frame(test_new, crossed_data)
</span>
<span class="cp"># cross cbcl and brain features
# save the crossed features into crossed_data
</span>
<span class="n">crossed_data</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)){</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)){</span>
    <span class="n">crossed_feature</span> <span class="o">&lt;-</span> <span class="n">abcd_cbcl_final</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_brain_final</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span>
    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">,</span> <span class="n">crossed_feature</span><span class="p">)</span>

    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)[</span><span class="n">j</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="sc">'_'</span><span class="p">)</span>
    <span class="n">colnames</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)[</span><span class="n">which</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span> <span class="o">==</span> <span class="err">'</span><span class="n">crossed_feature</span><span class="err">'</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="n">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data_final_crossed</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="p">,</span> <span class="n">crossed_data</span><span class="p">)</span>
<span class="cp">#test_new_keep &lt;- test_new
#test_new &lt;- data.frame(test_new, crossed_data)
</span>
<span class="cp"># cross cbcl and brain and prs features
# save the crossed features into crossed_data
</span>
<span class="n">crossed_data</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)){</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)){</span>
    <span class="k">for</span><span class="p">(</span><span class="n">k</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_PRS_final</span><span class="p">)){</span>
      <span class="n">crossed_feature</span> <span class="o">&lt;-</span> <span class="n">abcd_cbcl_final</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_brain_final</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_PRS_final</span><span class="p">[,</span><span class="n">k</span><span class="p">]</span>
      <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">,</span> <span class="n">crossed_feature</span><span class="p">)</span>

      <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span>
      <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)[</span><span class="n">j</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_PRS_final</span><span class="p">)[</span><span class="n">k</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="sc">'_'</span><span class="p">)</span>
      <span class="n">colnames</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)[</span><span class="n">which</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span> <span class="o">==</span> <span class="err">'</span><span class="n">crossed_feature</span><span class="err">'</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="n">name</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data_final_crossed</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="p">,</span> <span class="n">crossed_data</span><span class="p">)</span>
<span class="cp">#test_new_keep &lt;- test_new
#test_new &lt;- data.frame(test_new, crossed_data)
</span>
<span class="n">ncol</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="p">)</span>

<span class="cp"># make this reproducible
</span><span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="cp">#split into train and test data
</span><span class="n">train</span><span class="p">.</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="n">createDataPartition</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data_final_crossed</span><span class="p">[</span> <span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>
<span class="n">test</span>  <span class="o">&lt;-</span> <span class="n">data_final_crossed</span><span class="p">[</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>

<span class="n">table</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">full</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">train</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">test</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">test</span> <span class="n">set</span>

<span class="cp"># identify predictor and response
</span><span class="n">y</span> <span class="o">&lt;-</span> <span class="s">"HCvsSI"</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="n">names</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="o">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">4014</span><span class="o">:</span><span class="mi">4024</span><span class="p">,</span><span class="mi">4028</span><span class="o">:</span><span class="mi">6947</span><span class="p">)])</span>

<span class="cp"># for binary classification, response should be a factor
</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>
<span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>

<span class="cp"># significance selection: same loop for all predictors
</span><span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="n">x</span><span class="p">){</span>
  <span class="n">form</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="sc">'~'</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
  <span class="n">fit</span> <span class="o">&lt;-</span> <span class="n">glm</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">formula</span><span class="p">(</span><span class="n">form</span><span class="p">),</span> <span class="n">family</span><span class="o">=</span><span class="err">'</span><span class="n">binomial</span><span class="err">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
  <span class="n">p_value</span> <span class="o">&lt;-</span> <span class="n">coef</span><span class="p">(</span><span class="n">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">))[,</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
  <span class="k">if</span><span class="p">(</span><span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">){</span>
    <span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">x_significant</span><span class="p">,</span> <span class="n">names</span><span class="p">(</span><span class="n">p_value</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">head</span><span class="p">(</span><span class="n">x_significant</span><span class="p">)</span>

<span class="cp"># add age as the necessary covariate
</span><span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="err">'</span><span class="n">age</span><span class="err">'</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">)</span>

<span class="cp"># extract the significant features from the train and test sets
</span><span class="n">train</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">))</span>
<span class="n">test</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">))</span>
<span class="n">test_new</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">test_new</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">))</span>

<span class="cp"># prepare for Auto ML
</span><span class="n">h2o</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="cp"># create an index column for stratified cross-validation
</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">rep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">fold_column</span><span class="p">,</span> <span class="n">train</span><span class="p">)</span>

<span class="n">k_folds</span> <span class="o">&lt;-</span> <span class="mi">5</span>
<span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train</span><span class="err">$</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">createFolds</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_folds</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span> <span class="err">#</span><span class="n">healthy</span> <span class="n">controls</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)])</span> <span class="err">#</span><span class="n">suicidal</span> <span class="n">ideation</span>

<span class="cp"># train the model
</span><span class="n">train_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">aml</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">automl</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_significant</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                  <span class="n">training_frame</span><span class="o">=</span><span class="n">train_h2o</span><span class="p">,</span>
                  <span class="n">max_models</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                  <span class="n">max_runtime_secs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                  <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">fold_column</span><span class="o">=</span><span class="err">'</span><span class="n">fold_column</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># view the AutoML Leaderboard
</span><span class="n">lb</span> <span class="o">&lt;-</span> <span class="n">aml</span><span class="err">@</span><span class="n">leaderboard</span>
<span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="err">#</span><span class="n">use</span> <span class="n">print</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">nrow</span><span class="p">(</span><span class="n">lb</span><span class="p">))</span> <span class="n">to</span> <span class="n">print</span> <span class="n">all</span> <span class="n">rows</span> <span class="n">instead</span> <span class="n">of</span> <span class="k">default</span> <span class="p">(</span><span class="mi">6</span> <span class="n">rows</span><span class="p">)</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_initial</span> <span class="n">automl</span> <span class="n">models_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbcldmri</span><span class="o">+</span><span class="n">cbclprsdmri</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># the leader model is stored here: aml@leader
</span>
<span class="cp"># prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_H2OAutoML_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbcldmri</span><span class="o">+</span><span class="n">cbclprsdmri</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_leadermodel_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbcldmri</span><span class="o">+</span><span class="n">cbclprsdmri</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>

<span class="cp"># check the variable importance
</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">50</span><span class="p">,]</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">)),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_variable</span> <span class="n">importance_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbcldmri</span><span class="o">+</span><span class="n">cbclprsdmri</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># explain leader model &amp; compare with all AutoML models
</span><span class="n">exp</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">explain</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">exp</span>

<span class="cp"># test on test_new
# prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test_new</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_H2OAutoML_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbcldmri</span><span class="o">+</span><span class="n">cbclprsdmri_vul</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_leadermodel_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbcldmri</span><span class="o">+</span><span class="n">cbclprsdmri_vul</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>

<span class="cp"># -----
</span>
<span class="cp"># CASE F4 : demo + cbcl + cbcl*brain
# (add fmri and freesurfer data)
</span>
<span class="cp"># extract brain and cbcl features from data
# only important brain features will be used
</span>
<span class="n">cbcl_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"cbcl_scr_syn_anxdep_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_withdep_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_somatic_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_social_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_thought_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_attention_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_rulebreak_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_aggressive_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_internal_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_external_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_totprob_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_depress_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_anxdisord_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_somaticpr_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_adhd_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_opposit_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_conduct_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_sct_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_ocd_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_stress_r"</span><span class="p">)</span>
<span class="n">cbcl_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">cbcl_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">cbcl_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">cbcl_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">abcd_cbcl_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">cbcl_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_cbcl_final &lt;- subset(test_new, select=cbcl_names_sel)
</span>
<span class="n">brain_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"con_L.TTG_R.PCU_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.LOFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.MOFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CU_R.SPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.IN_R.MTG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PaCG_L.CA_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.HI_R.MTG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.EC_L.IPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PCG_R.SMG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.FG_R.SMG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PaCG_R.CMFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.IN_L.CA_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PCAL_R.TH_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PHIG_L.SPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.PHIG_R.PoCG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.POR_L.PU_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.POP_L.RMFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.PaCG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.CA_R.PTR_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.LG_R.ITG_fa"</span><span class="p">,</span>
                 <span class="s">"tfmri_sstr1_106"</span><span class="p">,</span>
                 <span class="s">"tfmri_sstr1_154"</span><span class="p">,</span>
                 <span class="s">"tfmri_sstr1_76"</span><span class="p">,</span>
                 <span class="s">"rh_isthmuscingulate_meancurv._.4"</span><span class="p">,</span>
                 <span class="s">"lh_lateraloccipital_area._.1"</span><span class="p">)</span>
<span class="n">brain_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">brain_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">brain_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">brain_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">abcd_brain_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">brain_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_brain_final &lt;- subset(test_new, select=brain_names_sel)
</span>
<span class="cp"># cross cbcl and brain features
# save the crossed features into crossed_data
</span>
<span class="n">crossed_data</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)){</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)){</span>
    <span class="n">crossed_feature</span> <span class="o">&lt;-</span> <span class="n">abcd_cbcl_final</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_brain_final</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span>
    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">,</span> <span class="n">crossed_feature</span><span class="p">)</span>

    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)[</span><span class="n">j</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="sc">'_'</span><span class="p">)</span>
    <span class="n">colnames</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)[</span><span class="n">which</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span> <span class="o">==</span> <span class="err">'</span><span class="n">crossed_feature</span><span class="err">'</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="n">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data_final_crossed</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">crossed_data</span><span class="p">)</span>
<span class="cp">#test_new_keep &lt;- test_new
#test_new &lt;- data.frame(test_new, crossed_data)
</span>
<span class="n">ncol</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="p">)</span>

<span class="cp"># make this reproducible
</span><span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="cp">#split into train and test data
</span><span class="n">train</span><span class="p">.</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="n">createDataPartition</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data_final_crossed</span><span class="p">[</span> <span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>
<span class="n">test</span>  <span class="o">&lt;-</span> <span class="n">data_final_crossed</span><span class="p">[</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>

<span class="n">table</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">full</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">train</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">test</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">test</span> <span class="n">set</span>

<span class="cp"># identify predictor and response
</span><span class="n">y</span> <span class="o">&lt;-</span> <span class="s">"HCvsSI"</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="n">names</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="o">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">4014</span><span class="o">:</span><span class="mi">4024</span><span class="p">,</span><span class="mi">4028</span><span class="o">:</span><span class="mi">4527</span><span class="p">)])</span>

<span class="cp"># for binary classification, response should be a factor
</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>
<span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>

<span class="cp"># prepare for Auto ML
</span><span class="n">h2o</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="cp"># create an index column for stratified cross-validation
</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">rep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">fold_column</span><span class="p">,</span> <span class="n">train</span><span class="p">)</span>

<span class="n">k_folds</span> <span class="o">&lt;-</span> <span class="mi">5</span>
<span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train</span><span class="err">$</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">createFolds</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_folds</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span> <span class="err">#</span><span class="n">healthy</span> <span class="n">controls</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)])</span> <span class="err">#</span><span class="n">suicidal</span> <span class="n">ideation</span>

<span class="cp"># train the model
</span><span class="n">train_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">aml</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">automl</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                  <span class="n">training_frame</span><span class="o">=</span><span class="n">train_h2o</span><span class="p">,</span>
                  <span class="n">max_models</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                  <span class="n">max_runtime_secs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                  <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">fold_column</span><span class="o">=</span><span class="err">'</span><span class="n">fold_column</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># view the AutoML Leaderboard
</span><span class="n">lb</span> <span class="o">&lt;-</span> <span class="n">aml</span><span class="err">@</span><span class="n">leaderboard</span>
<span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="err">#</span><span class="n">use</span> <span class="n">print</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">nrow</span><span class="p">(</span><span class="n">lb</span><span class="p">))</span> <span class="n">to</span> <span class="n">print</span> <span class="n">all</span> <span class="n">rows</span> <span class="n">instead</span> <span class="n">of</span> <span class="k">default</span> <span class="p">(</span><span class="mi">6</span> <span class="n">rows</span><span class="p">)</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_initial</span> <span class="n">automl</span> <span class="n">models_demo</span><span class="o">+</span><span class="n">cbclbrain</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># the leader model is stored here: aml@leader
</span>
<span class="cp"># prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_H2OAutoML_demo</span><span class="o">+</span><span class="n">cbclbrain</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_leadermodel_demo</span><span class="o">+</span><span class="n">cbclbrain</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>

<span class="cp"># check the variable importance
</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">50</span><span class="p">,]</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">)),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_variable</span> <span class="n">importance_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="o">+</span><span class="n">cbclbrain</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># explain leader model &amp; compare with all AutoML models
</span><span class="n">exp</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">explain</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">exp</span>

<span class="cp"># test on test_new
# prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test_new</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_H2OAutoML_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="o">+</span><span class="n">cbclbrain_vul</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_leadermodel_demo</span><span class="o">+</span><span class="n">cbcl</span><span class="o">+</span><span class="n">cbclbrain_vul</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>

<span class="cp"># -----
</span>
<span class="cp"># CASE F5 : demo + cbcl + cbcl*prs + cbcl*brain + cbcl*prs*brain
# (add fmri and freesurfer data)
</span>
<span class="cp"># extract brain and cbcl features from data
# only important brain features will be used
</span>
<span class="n">PRS_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"ADHDeur6"</span><span class="p">,</span> <span class="s">"SCZ_EURauto"</span><span class="p">,</span> <span class="s">"GHappiMeaneur1"</span><span class="p">,</span> <span class="s">"ASDauto"</span><span class="p">,</span> <span class="s">"MDDeur6"</span><span class="p">,</span> <span class="s">"PTSDeur4"</span><span class="p">)</span>
<span class="n">PRS_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">PRS_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">PRS_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">PRS_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">abcd_PRS_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">PRS_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_PRS_final &lt;- subset(test_new, select=PRS_names_sel)
</span>
<span class="n">brain_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"con_L.TTG_R.PCU_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.LOFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.MOFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CU_R.SPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.IN_R.MTG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PaCG_L.CA_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.HI_R.MTG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.EC_L.IPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PCG_R.SMG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.FG_R.SMG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PaCG_R.CMFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.IN_L.CA_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PCAL_R.TH_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.PHIG_L.SPG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.PHIG_R.PoCG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.POR_L.PU_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.POP_L.RMFG_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.CACG_R.PaCG_fa"</span><span class="p">,</span>
                 <span class="s">"con_R.CA_R.PTR_fa"</span><span class="p">,</span>
                 <span class="s">"con_L.LG_R.ITG_fa"</span><span class="p">,</span>
                 <span class="s">"tfmri_sstr1_106"</span><span class="p">,</span>
                 <span class="s">"tfmri_sstr1_154"</span><span class="p">,</span>
                 <span class="s">"tfmri_sstr1_76"</span><span class="p">,</span>
                 <span class="s">"rh_isthmuscingulate_meancurv._.4"</span><span class="p">,</span>
                 <span class="s">"lh_lateraloccipital_area._.1"</span><span class="p">)</span>
<span class="n">brain_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">brain_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">brain_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">brain_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">abcd_brain_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">brain_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_brain_final &lt;- subset(test_new, select=brain_names_sel)
</span>
<span class="n">cbcl_names</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s">"cbcl_scr_syn_anxdep_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_withdep_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_somatic_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_social_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_thought_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_attention_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_rulebreak_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_aggressive_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_internal_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_external_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_syn_totprob_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_depress_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_anxdisord_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_somaticpr_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_adhd_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_opposit_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_dsm5_conduct_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_sct_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_ocd_r"</span><span class="p">,</span>
                <span class="s">"cbcl_scr_07_stress_r"</span><span class="p">)</span>
<span class="n">cbcl_names_sel</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span><span class="p">(</span><span class="n">name</span> <span class="n">in</span> <span class="n">cbcl_names</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">name</span> <span class="o">%</span><span class="n">in</span><span class="o">%</span> <span class="n">names</span><span class="p">(</span><span class="n">data_final</span><span class="p">)){</span>
    <span class="n">cbcl_names_sel</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">cbcl_names_sel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">abcd_cbcl_final</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">cbcl_names_sel</span><span class="p">)</span>
<span class="cp">#abcd_cbcl_final &lt;- subset(test_new, select=cbcl_names_sel)
</span>
<span class="cp"># cross PRS and cbcl features
# save the crossed features into crossed_data
</span>
<span class="n">crossed_data</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_PRS_final</span><span class="p">)){</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)){</span>
    <span class="n">crossed_feature</span> <span class="o">&lt;-</span> <span class="n">abcd_PRS_final</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_cbcl_final</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span>
    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">,</span> <span class="n">crossed_feature</span><span class="p">)</span>

    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">abcd_PRS_final</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)[</span><span class="n">j</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="sc">'_'</span><span class="p">)</span>
    <span class="n">colnames</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)[</span><span class="n">which</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span> <span class="o">==</span> <span class="err">'</span><span class="n">crossed_feature</span><span class="err">'</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="n">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data_final_crossed</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">crossed_data</span><span class="p">)</span>
<span class="cp">#test_new_keep &lt;- test_new
#test_new &lt;- data.frame(test_new, crossed_data)
</span>
<span class="cp"># cross cbcl and brain features
# save the crossed features into crossed_data
</span>
<span class="n">crossed_data</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)){</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)){</span>
    <span class="n">crossed_feature</span> <span class="o">&lt;-</span> <span class="n">abcd_cbcl_final</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_brain_final</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span>
    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">,</span> <span class="n">crossed_feature</span><span class="p">)</span>

    <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)[</span><span class="n">j</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="sc">'_'</span><span class="p">)</span>
    <span class="n">colnames</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)[</span><span class="n">which</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span> <span class="o">==</span> <span class="err">'</span><span class="n">crossed_feature</span><span class="err">'</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="n">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data_final_crossed</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="p">,</span> <span class="n">crossed_data</span><span class="p">)</span>
<span class="cp">#test_new_keep &lt;- test_new
#test_new &lt;- data.frame(test_new, crossed_data)
</span>
<span class="cp"># cross cbcl and brain and prs features
# save the crossed features into crossed_data
</span>
<span class="n">crossed_data</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)){</span>
  <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)){</span>
    <span class="k">for</span><span class="p">(</span><span class="n">k</span> <span class="n">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">abcd_PRS_final</span><span class="p">)){</span>
      <span class="n">crossed_feature</span> <span class="o">&lt;-</span> <span class="n">abcd_cbcl_final</span><span class="p">[,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_brain_final</span><span class="p">[,</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">abcd_PRS_final</span><span class="p">[,</span><span class="n">k</span><span class="p">]</span>
      <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">,</span> <span class="n">crossed_feature</span><span class="p">)</span>

      <span class="n">crossed_data</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span>
      <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">abcd_cbcl_final</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_brain_final</span><span class="p">)[</span><span class="n">j</span><span class="p">],</span> <span class="n">names</span><span class="p">(</span><span class="n">abcd_PRS_final</span><span class="p">)[</span><span class="n">k</span><span class="p">],</span> <span class="n">sep</span><span class="o">=</span><span class="sc">'_'</span><span class="p">)</span>
      <span class="n">colnames</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)[</span><span class="n">which</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">crossed_data</span><span class="p">)</span> <span class="o">==</span> <span class="err">'</span><span class="n">crossed_feature</span><span class="err">'</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="n">name</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">data_final_crossed</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="p">,</span> <span class="n">crossed_data</span><span class="p">)</span>
<span class="cp">#test_new_keep &lt;- test_new
#test_new &lt;- data.frame(test_new, crossed_data)
</span>
<span class="n">ncol</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="p">)</span>

<span class="cp"># make this reproducible
</span><span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="cp">#split into train and test data
</span><span class="n">train</span><span class="p">.</span><span class="n">index</span> <span class="o">&lt;-</span> <span class="n">createDataPartition</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data_final_crossed</span><span class="p">[</span> <span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>
<span class="n">test</span>  <span class="o">&lt;-</span> <span class="n">data_final_crossed</span><span class="p">[</span><span class="o">-</span><span class="n">train</span><span class="p">.</span><span class="n">index</span><span class="p">,]</span>

<span class="n">table</span><span class="p">(</span><span class="n">data_final_crossed</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">full</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">train</span> <span class="n">set</span>
<span class="n">table</span><span class="p">(</span><span class="n">test</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">)</span> <span class="err">#</span><span class="n">test</span> <span class="n">set</span>

<span class="cp"># identify predictor and response
</span><span class="n">y</span> <span class="o">&lt;-</span> <span class="s">"HCvsSI"</span>
<span class="n">x</span> <span class="o">&lt;-</span> <span class="n">names</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="mi">2</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="o">:</span><span class="mi">33</span><span class="p">,</span><span class="mi">4014</span><span class="o">:</span><span class="mi">4024</span><span class="p">,</span><span class="mi">4028</span><span class="o">:</span><span class="mi">7647</span><span class="p">)])</span>

<span class="cp"># for binary classification, response should be a factor
</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">train</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>
<span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">factor</span><span class="p">(</span><span class="n">test</span><span class="p">[,</span><span class="n">y</span><span class="p">])</span>

<span class="cp"># significance selection: same loop for all predictors
</span><span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="n">x</span><span class="p">){</span>
  <span class="n">form</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="sc">'~'</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
  <span class="n">fit</span> <span class="o">&lt;-</span> <span class="n">glm</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">formula</span><span class="p">(</span><span class="n">form</span><span class="p">),</span> <span class="n">family</span><span class="o">=</span><span class="err">'</span><span class="n">binomial</span><span class="err">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
  <span class="n">p_value</span> <span class="o">&lt;-</span> <span class="n">coef</span><span class="p">(</span><span class="n">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">))[,</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
  <span class="k">if</span><span class="p">(</span><span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">){</span>
    <span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="n">x_significant</span><span class="p">,</span> <span class="n">names</span><span class="p">(</span><span class="n">p_value</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">head</span><span class="p">(</span><span class="n">x_significant</span><span class="p">)</span>

<span class="cp"># add age as the necessary covariate
</span><span class="n">x_significant</span> <span class="o">&lt;-</span> <span class="n">append</span><span class="p">(</span><span class="err">'</span><span class="n">age</span><span class="err">'</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">)</span>

<span class="cp"># extract the significant features from the train and test sets
</span><span class="n">train</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">))</span>
<span class="n">test</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">))</span>
<span class="n">test_new</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">test_new</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x_significant</span><span class="p">))</span>

<span class="cp"># prepare for Auto ML
</span><span class="n">h2o</span><span class="p">.</span><span class="n">init</span><span class="p">()</span>

<span class="cp"># create an index column for stratified cross-validation
</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">rep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span><span class="p">(</span><span class="n">train</span><span class="p">))</span>
<span class="n">train</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">fold_column</span><span class="p">,</span> <span class="n">train</span><span class="p">)</span>

<span class="n">k_folds</span> <span class="o">&lt;-</span> <span class="mi">5</span>
<span class="n">set</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">train</span><span class="err">$</span><span class="n">fold_column</span> <span class="o">&lt;-</span> <span class="n">createFolds</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_folds</span><span class="p">,</span> <span class="n">list</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)])</span> <span class="err">#</span><span class="n">healthy</span> <span class="n">controls</span>

<span class="n">table</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">fold_column</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">train</span><span class="err">$</span><span class="n">HCvsSI</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)])</span> <span class="err">#</span><span class="n">suicidal</span> <span class="n">ideation</span>

<span class="cp"># train the model
</span><span class="n">train_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">aml</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">automl</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_significant</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                  <span class="n">training_frame</span><span class="o">=</span><span class="n">train_h2o</span><span class="p">,</span>
                  <span class="n">max_models</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                  <span class="n">max_runtime_secs</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                  <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">fold_column</span><span class="o">=</span><span class="err">'</span><span class="n">fold_column</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># view the AutoML Leaderboard
</span><span class="n">lb</span> <span class="o">&lt;-</span> <span class="n">aml</span><span class="err">@</span><span class="n">leaderboard</span>
<span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="err">#</span><span class="n">use</span> <span class="n">print</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">nrow</span><span class="p">(</span><span class="n">lb</span><span class="p">))</span> <span class="n">to</span> <span class="n">print</span> <span class="n">all</span> <span class="n">rows</span> <span class="n">instead</span> <span class="n">of</span> <span class="k">default</span> <span class="p">(</span><span class="mi">6</span> <span class="n">rows</span><span class="p">)</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">lb</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_initial</span> <span class="n">automl</span> <span class="n">models_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbclbrain</span><span class="o">+</span><span class="n">cbclprsbrain</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># the leader model is stored here: aml@leader
</span>
<span class="cp"># prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_H2OAutoML_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbclbrain</span><span class="o">+</span><span class="n">cbclprsbrain</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_leadermodel_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbclbrain</span><span class="o">+</span><span class="n">cbclprsbrain</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>

<span class="cp"># check the variable importance
</span><span class="n">df</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">50</span><span class="p">,]</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">h2o</span><span class="p">.</span><span class="n">varimp</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">)),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_variable</span> <span class="n">importance_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbclbrain</span><span class="o">+</span><span class="n">cbclprsbrain</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># explain leader model &amp; compare with all AutoML models
</span><span class="n">exp</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">explain</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">exp</span>

<span class="cp"># test on test_new
# prediction
</span><span class="n">test_h2o</span> <span class="o">&lt;-</span> <span class="n">as</span><span class="p">.</span><span class="n">h2o</span><span class="p">(</span><span class="n">test_new</span><span class="p">,</span> <span class="n">use_datatable</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="cp"># to generate predictions on a test set, you can make predictions directly on the 'H2OAutoML' object or on the leader model
</span><span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="n">object</span> <span class="n">directly</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_H2OAutoML_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbclbrain</span><span class="o">+</span><span class="n">cbclprsbrain_vul</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span> <span class="err">#</span><span class="k">using</span> <span class="n">leader</span> <span class="n">model</span>
<span class="n">head</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="n">kbl</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">kable_styling</span><span class="p">(</span><span class="n">bootstrap_options</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="err">'</span><span class="n">condensed</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">striped</span><span class="err">'</span><span class="p">))</span>
<span class="n">write</span><span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">as</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="err">'</span><span class="n">FINAL_prediction_leadermodel_demo</span><span class="o">+</span><span class="n">cbclprs</span><span class="o">+</span><span class="n">cbclbrain</span><span class="o">+</span><span class="n">cbclprsbrain_vul</span><span class="p">.</span><span class="n">csv</span><span class="err">'</span><span class="p">)</span>

<span class="cp"># check the performance of the leader model
</span><span class="n">perf</span> <span class="o">&lt;-</span> <span class="n">h2o</span><span class="p">.</span><span class="n">performance</span><span class="p">(</span><span class="n">aml</span><span class="err">@</span><span class="n">leader</span><span class="p">,</span> <span class="n">test_h2o</span><span class="p">)</span>
<span class="n">perf</span>
</pre></td>
</tr></tbody></table></code></pre></figure>


  </article>

</div>

    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2023 Yeonwoo  JEONG. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.2/dist/umd/popper.min.js" integrity="sha256-l/1pMF/+J4TThfgARS6KwWrk/egwuVvhRzfLAMQ6Ds4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha256-SyTu6CwrfOhaznYZPoolVw2rxoY7lKYKQvqbtqN93HI=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="/assets/js/zoom.js"></script><!-- Load Common JS -->
  <script src="/assets/js/common.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
  </body>
</html>

